import scrapy
from urllib.parse import urljoin
from koc_crawler.items import ArticleItem

import scrapy
from urllib.parse import urljoin
from koc_crawler.items import ArticleItem
import json

class KocSpider(scrapy.Spider):
    name = "koc"
    allowed_domains = ["koc.com.tw"]
    
    custom_settings = {
        "DEPTH_LIMIT": 1000
    }
    
    # 新增：設定您想要抓取的最大頁數
    MAX_PAGES = 5  # 這裡以抓取 5 頁為例

    def start_requests(self):
        yield scrapy.FormRequest(
            url="https://www.koc.com.tw/?ajax-request=jnews",
            formdata={
                "lang": "zh_TW",
                "action": "jnews_module_ajax_jnews_block_3",
                "module": "true",
                "data[filter]": "0",
                "data[filter_type]": "all",
                "data[current_page]": "1",
                "data[attribute][sticky_post]": "false",
                "data[attribute][post_type]": "post",
                "data[attribute][number_post]": "12",
                "data[attribute][sort_by]": "latest",
                "data[attribute][pagination_mode]": "scrollload",
            },
            callback=self.parse_ajax_response,
            meta={"page": 1}
        )

    def parse_ajax_response(self, response):
        page = response.meta["page"]
        
        try:
            data = json.loads(response.text)
            html_content = data.get("content")
        except json.JSONDecodeError:
            self.logger.error("Failed to decode JSON from response.")
            return

        selector = scrapy.Selector(text=html_content, type="html")
        article_blocks = selector.css(".jeg_post")
        
        if not article_blocks:
            self.logger.info("No more articles found. Stopping.")
            return

        for block in article_blocks:
            item = self.extract_article_info(block, response.url)
            yield item
        
        # 關鍵修改：檢查當前頁碼是否達到上限
        if page < self.MAX_PAGES:
            next_page = page + 1
            self.logger.info(f"Scraping next page: {next_page}")

            yield scrapy.FormRequest(
                url="https://www.koc.com.tw/?ajax-request=jnews",
                formdata={
                    "lang": "zh_TW",
                    "action": "jnews_module_ajax_jnews_block_3",
                    "module": "true",
                    "data[filter]": "0",
                    "data[filter_type]": "all",
                    "data[current_page]": str(next_page),
                    "data[attribute][sticky_post]": "false",
                    "data[attribute][post_type]": "post",
                    "data[attribute][number_post]": "12",
                    "data[attribute][sort_by]": "latest",
                    "data[attribute][pagination_mode]": "scrollload",
                },
                callback=self.parse_ajax_response,
                meta={"page": next_page}
            )
        else:
            self.logger.info(f"Reached max page limit of {self.MAX_PAGES}. Stopping.")
            return
    
    def extract_article_info(self, selector, base_url):
        # 這裡的程式碼不變
        item = ArticleItem()
        href = selector.css('h3.jeg_post_title a::attr(href)').get()
        item["url"] = urljoin(base_url, href) if href else ""
        item["title"] = selector.css('h3.jeg_post_title a::text').get(default="").strip()
        item["author"] = selector.css('.jeg_meta_author a::text').get(default="").strip()
        pub_text = selector.css('.jeg_meta_date a::text').get()
        item["published_at"] = pub_text.strip() if pub_text else ""
        
        excerpt = selector.css('.jeg_post_excerpt p::text').getall()
        item["content"] = "\n".join([p.strip() for p in excerpt if p.strip()])
        return item


#======================== v.0.3 ========================#
# class KocSpider(scrapy.Spider):
#     name = "koc"
#     allowed_domains = ["koc.com.tw"]
    
#     # 這裡不再使用 start_urls，改用 start_requests
#     # start_urls = ["https://www.koc.com.tw/"]
    
#     custom_settings = {
#         "DEPTH_LIMIT": 1  # 只抓首頁，深度設為 1
#     }

#     def start_requests(self):
#         # 這是第一頁的請求，使用 POST 方法
#         page = 1
#         body = f"lang=zh_TW&action=jnews_module_ajax_jnews_block_3&module=true&data%5Bfilter%5D=0&data%5Bfilter_type%5D=all&data%5Bcurrent_page%5D={page}&data%5Battribute%5D%5Bheader_icon%5D=&data%5Battribute%5D%5Bfirst_title%5D=&data%5Battribute%5D%5Bsecond_title%5D=&data%5Battribute%5D%5Burl%5D=&data%5Battribute%5D%5Bheader_type%5D=heading_6&data%5Battribute%5D%5Bheader_background%5D=&data%5Battribute%5D%5Bheader_secondary_background%5D=&data%5Battribute%5D%5Bheader_text_color%5D=&data%5Battribute%5D%5Bheader_line_color%5D=&data%5Battribute%5D%5Bheader_accent_color%5D=&data%5Battribute%5D%5Bheader_filter_category%5D=&data%5Battribute%5D%5Bheader_filter_author%5D=&data%5Battribute%5D%5Bheader_filter_tag%5D=&data%5Battribute%5D%5Bheader_filter_text%5D=&data%5Battribute%5D%5Bsticky_post%5D=false&data%5Battribute%5D%5Bpost_type%5D=post&data%5Battribute%5D%5Bcontent_type%5D=all&data%5Battribute%5D%5Bsponsor%5D=false&data%5Battribute%5D%5Bnumber_post%5D=12&data%5Battribute%5D%5Bpost_offset%5D=0&data%5Battribute%5D%5Bunique_content%5D=disable&data%5Battribute%5D%5Binclude_post%5D=&data%5Battribute%5D%5Bincluded_only%5D=false&data%5Battribute%5D%5Bexclude_post%5D=&data%5Battribute%5D%5Binclude_category%5D=&data%5Battribute%5D%5Bexclude_category%5D=&data%5Battribute%5D%5Binclude_author%5D=&data%5Battribute%5D%5Binclude_tag%5D=&data%5Battribute%5D%5Bexclude_tag%5D=&data%5Battribute%5D%5Bsort_by%5D=latest&data%5Battribute%5D%5Bdate_format%5D=default&data%5Battribute%5D%5Bdate_format_custom%5D=Y%2Fm%2Fd&data%5Battribute%5D%5Bexcerpt_length%5D%5Bunit%5D=px&data%5Battribute%5D%5Bexcerpt_length%5D%5Bsize%5D=45&data%5Battribute%5D%5Bexcerpt_ellipsis%5D=...&data%5Battribute%5D%5Bforce_normal_image_load%5D=&data%5Battribute%5D%5Bpagination_mode%5D=scrollload&data%5Battribute%5D%5Bpagination_nextprev_showtext%5D=&data%5Battribute%5D%5Bpagination_number_post%5D%5Bunit%5D=px&data%5Battribute%5D%5Bpagination_number_post%5D%5Bsize%5D=12&data%5Battribute%5D%5Bpagination_scroll_limit%5D=36&data%5Battribute%5D%5Bads_type%5D=disable&data%5Battribute%5D%5Bads_position%5D%5Bunit%5D=px&data%5Battribute%5D%5Bads_position%5D%5Bsize%5D=1&data%5Battribute%5D%5Bads_random%5D=&data%5Battribute%5D%5Bads_image%5D%5Burl%5D=&data%5Battribute%5D%5Bads_image%5D%5Bid%5D=&data%5Battribute%5D%5Bads_image%5D%5Bsize%5D=&data%5Battribute%5D%5Bads_image_tablet%5D%5Burl%5D=&data%5Battribute%5D%5Bads_image_tablet%5D%5Bid%5D=&data%5Battribute%5D%5Bads_image_tablet%5D%5Bsize%5D=&data%5Battribute%5D%5Bads_image_phone%5D%5Burl%5D=&data%5Battribute%5D%5Bads_image_phone%5D%5Bid%5D=&data%5Battribute%5D%5Bads_image_phone%5D%5Bsize%5D=&data%5Battribute%5D%5Bads_image_link%5D=&data%5Battribute%5D%5Bads_image_alt%5D=&data%5Battribute%5D%5Bads_image_new_tab%5D=&data%5Battribute%5D%5Bgoogle_publisher_id%5D=&data%5Battribute%5D%5Bgoogle_slot_id%5D=&data%5Battribute%5D%5Bgoogle_desktop%5D=auto&data%5Battribute%5D%5Bgoogle_tab%5D=auto&data%5Battribute%5D%5Bgoogle_phone%5D=auto&data%5Battribute%5D%5Bcontent%5D=&data%5Battribute%5D%5Bads_bottom_text%5D=&data%5Battribute%5D%5Bboxed%5D=&data%5Battribute%5D%5Bboxed_shadow%5D=&data%5Battribute%5D%5Bel_id%5D=&data%5Battribute%5D%5Bel_class%5D=&data%5Battribute%5D%5Bscheme%5D=&data%5Battribute%5D%5Bcolumn_width%5D=auto&data%5Battribute%5D%5Btitle_color%5D=&data%5Battribute%5D%5Baccent_color%5D=&data%5Battribute%5D%5Balt_color%5D=&data%5Battribute%5D%5Bexcerpt_color%5D=&data%5Battribute%5D%5Bcss%5D=&data%5Battribute%5D%5Btitle_typography_typography%5D=&data%5Battribute%5D%5Btitle_typography_font_family%5D=&data%5Battribute%5D%5Btitle_typography_font_size%5D%5Bunit%5D=px&data%5Battribute%5D%5Btitle_typography_font_size%5D%5Bsize%5D=&data%5Battribute%5D%5Btitle_typography_font_weight%5D=&data%5Battribute%5D%5Btitle_typography_text_transform%5D=&data%5Battribute%5D%5Btitle_typography_font_style%5D=&data%5Battribute%5D%5Btitle_typography_text_decoration%5D=&data%5Battribute%5D%5Btitle_typography_line_height%5D%5Bunit%5D=px&data%5Battribute%5D%5Btitle_typography_line_height%5D%5Bsize%5D=&data%5Battribute%5D%5Btitle_typography_letter_spacing%5D%5Bunit%5D=px&data%5Battribute%5D%5Btitle_typography_letter_spacing%5D%5Bsize%5D=&data%5Battribute%5D%5Btitle_typography_word_spacing%5D%5Bunit%5D=px&data%5Battribute%5D%5Btitle_typography_word_spacing%5D%5Bsize%5D=&data%5Battribute%5D%5Bmeta_typography_typography%5D=&data%5Battribute%5D%5Bmeta_typography_font_family%5D=&data%5Battribute%5D%5Bmeta_typography_font_size%5D%5Bunit%5D=px&data%5Battribute%5D%5Bmeta_typography_font_size%5D%5Bsize%5D=&data%5Battribute%5D%5Bmeta_typography_font_weight%5D=&data%5Battribute%5D%5Bmeta_typography_text_transform%5D=&data%5Battribute%5D%5Bmeta_typography_font_style%5D=&data%5Battribute%5D%5Bmeta_typography_text_decoration%5D=&data%5Battribute%5D%5Bmeta_typography_line_height%5D%5Bunit%5D=px&data%5Battribute%5D%5Bmeta_typography_line_height%5D%5Bsize%5D=&data%5Battribute%5D%5Bmeta_typography_letter_spacing%5D%5Bunit%5D=px&data%5Battribute%5D%5Bmeta_typography_letter_spacing%5D%5Bsize%5D=&data%5Battribute%5D%5Bmeta_typography_word_spacing%5D%5Bunit%5D=px&data%5Battribute%5D%5Bmeta_typography_word_spacing%5D%5Bsize%5D=&data%5Battribute%5D%5Bcontent_typography_typography%5D=&data%5Battribute%5D%5Bcontent_typography_font_family%5D=&data%5Battribute%5D%5Bcontent_typography_font_size%5D%5Bunit%5D=px&data%5Battribute%5D%5Bcontent_typography_font_size%5D%5Bsize%5D=&data%5Battribute%5D%5Bcontent_typography_font_weight%5D=&data%5Battribute%5D%5Bcontent_typography_text_transform%5D=&data%5Battribute%5D%5Bcontent_typography_font_style%5D=&data%5Battribute%5D%5Bcontent_typography_text_decoration%5D=&data%5Battribute%5D%5Bcontent_typography_line_height%5D%5Bunit%5D=px&data%5Battribute%5D%5Bcontent_typography_line_height%5D%5Bsize%5D=&data%5Battribute%5D%5Bcontent_typography_letter_spacing%5D%5Bunit%5D=px&data%5Battribute%5D%5Bcontent_typography_letter_spacing%5D%5Bsize%5D=&data%5Battribute%5D%5Bcontent_typography_word_spacing%5D%5Bunit%5D=px&data%5Battribute%5D%5Bcontent_typography_word_spacing%5D%5Bsize%5D=&data%5Battribute%5D%5B_title%5D=&data%5Battribute%5D%5B_margin%5D%5Bunit%5D=px&data%5Battribute%5D%5B_margin%5D%5Btop%5D=&data%5Battribute%5D%5B_margin%5D%5Bright%5D=&data%5Battribute%5D%5B_margin%5D%5Bbottom%5D=&data%5Battribute%5D%5B_margin%5D%5Bleft%5D=&data%5Battribute%5D%5B_margin%5D%5BisLinked%5D=true&data%5Battribute%5D%5B_padding%5D%5Bunit%5D=px&data%5Battribute%5D%5B_padding%5D%5Btop%5D=&data%5Battribute%5D%5B_padding%5D%5Bright%5D=&data%5Battribute%5D%5B_padding%5D%5Bbottom%5D=&data%5Battribute%5D%5B_padding%5D%5Bleft%5D=&data%5Battribute%5D%5B_padding%5D%5BisLinked%5D=true&data%5Battribute%5D%5B_element_width%5D=&data%5Battribute%5D%5B_element_width_tablet%5D=&data%5Battribute%5D%5B_element_width_mobile%5D=&data%5Battribute%5D%5B_element_custom_width%5D%5Bunit%5D=%25&data%5Battribute%5D%5B_element_custom_width%5D%5Bsize%5D=&data%5Battribute%5D%5B_element_vertical_align%5D=&data%5Battribute%5D%5B_position_description%5D=&data%5Battribute%5D%5B_position%5D=&data%5Battribute%5D%5B_offset_orientation_h%5D=start&data%5Battribute%5D%5B_offset_x%5D%5Bunit%5D=px&data%5Battribute%5D%5B_offset_x%5D%5Bsize%5D=0&data%5Battribute%5D%5B_offset_x_end%5D%5Bunit%5D=px&data%5Battribute%5D%5B_offset_x_end%5D%5Bsize%5D=0&data%5Battribute%5D%5B_offset_orientation_v%5D=start&data%5Battribute%5D%5B_offset_y%5D%5Bunit%5D=px&data%5Battribute%5D%5B_offset_y%5D%5Bsize%5D=0&data%5Battribute%5D%5B_offset_y_end%5D%5Bunit%5D=px&data%5Battribute%5D%5B_offset_y_end%5D%5Bsize%5D=0&data%5Battribute%5D%5B_z_index%5D=&data%5Battribute%5D%5B_element_id%5D=&data%5Battribute%5D%5B_css_classes%5D=&data%5Battribute%5D%5B_animation%5D=&data%5Battribute%5D%5B_animation_tablet%5D=&data%5Battribute%5D%5B_animation_mobile%5D=&data%5Battribute%5D%5Banimation_duration%5D=&data%5Battribute%5D%5B_animation_delay%5D=&data%5Battribute%5D%5B_transform_rotate_popover%5D=&data%5Battribute%5D%5B_transform_rotateZ_effect%5D%5Bunit%5D=px&data%5Battribute%5D%5B_transform_rotateZ_effect%5D%5Bsize%5D=&data%5Battribute%5D%5B_transform_rotateZ_effect_tablet%5D%5Bunit%5D=deg&data%5Battribute%5D%5B_transform_rotateZ_effect_tablet%5D%5Bsize%5D=&data%5Battribute%5D%5B_transform_rotateZ_effect_mobile%5D%5Bunit%5D=deg&data%5Battribute%5D%5B_transform_rotateZ_effect_mobile%5D%5Bsize%5D=&data%5Battribute%5D%5B_transform_rotate_3d%5D=&data%5Battribute%5D%5B_transform_rotateX_effect%5D%5Bunit%5D=px&data%5Battribute%5D%5B_transform_rotateX_effect%5D%5Bsize%5D=&data%5Battribute%5D%5B_transform_rotateX_effect_tablet%5D%5Bunit%5D=deg&data%5Battribute%5D%5B_transform_rotateX_effect_tablet%5D%5Bsize%5D=&data%5Battribute%5D%5B_transform_rotateX_effect_mobile%5D%5Bunit%5D=deg&data%5Battribute%5D%5B_transform_rotateX_effect_mobile%5D%5Bsize%5D=&data%5Battribute%5D%5B_transform_rotateY_effect%5D%5Bunit%5D=px&data%5Battribute%5D%5B_transform_rotateY_effect%5D%5Bsize%5D=&data%5Battribute%5D%5B_transform_rotateY_effect_tablet%5D%5Bunit%5D=deg&data%5Battribute%5D%5B_transform_rotateY_effect_tablet%5D%5Bsize%5D=&data%5Battribute%5D%5B_transform_rotateY_effect_mobile%5D%5Bunit%5D=deg&data%5Battribute%5D%5B_transform_rotateY_effect_mobile%5D%5Bsize%5D=&data%5Battribute%5D%5B_transform_perspective_effect%5D%5Bunit%5D=px&data%5Battribute%5D%5B_transform_perspective_effect%5D%5Bsize%5D=&data%5Battribute%5D%5B_transform_perspective_effect_tablet%5D%5Bunit%5D=px&data%5Battribute%5D%5B_transform_perspective_effect_tablet%5D%5Bsize%5D=&data%5Battribute%5D%5B_transform_perspective_effect_mobile%5D%5Bunit%5D=px&data%5Battribute%5D%5B_transform_perspective_effect_mobile%5D%5Bsize%5D=&data%5Battribute%5D%5B_transform_translate_popover%5D=&data%5Battribute%5D%5B_transform_translateX_effect%5D%5Bunit%5D=px&data%5Battribute%5D%5B_transform_translateX_effect%5D%5Bsize%5D=&data%5Battribute%5D%5B_transform_translateX_effect_tablet%5D%5Bunit%5D=px&data%5Battribute%5D%5B_transform_translateX_effect_tablet%5D%5Bsize%5D=&data%5Battribute%5D%5B_transform_translateX_effect_mobile%5D%5Bunit%5D=px&data%5Battribute%5D%5B_transform_translateX_effect_mobile%5D%5Bsize%5D=&data%5Battribute%5D%5B_transform_translateY_effect%5D%5Bunit%5D=px&data%5Battribute%5D%5B_transform_translateY_effect%5D%5Bsize%5D=&data%5Battribute%5D%5B_transform_translateY_effect_tablet%5D%5Bunit%5D=px&data%5Battribute%5D%5B_transform_translateY_effect_tablet%5D%5Bsize%5D=&data%5Battribute%5D%5B_transform_translateY_effect_mobile%5D%5Bunit%5D=px&data%5Battribute%5D%5B_transform_translateY_effect_mobile%5D%5Bsize%5D=&data%5Battribute%5D%5B_transform_scale_popover%5D=&data%5Battribute%5D%5B_transform_keep_proportions%5D=yes&data%5Battribute%5D%5B_transform_scale_effect%5D%5Bunit%5D=px&data%5Battribute%5D%5B_transform_scale_effect%5D%5Bsize%5D=&data%5Battribute%5D%5B_transform_scale_effect_hover%5D%5Bunit%5D=px&data%5Battribute%5D%5B_transform_scale_effect_hover%5D%5Bsize%5D=&data%5Battribute%5D%5B_transform_scaleX_effect%5D%5Bunit%5D=px&data%5Battribute%5D%5B_transform_scaleX_effect%5D%5Bsize%5D=&data%5Battribute%5D%5B_transform_scaleX_effect_hover%5D%5Bunit%5D=px&data%5Battribute%5D%5B_transform_scaleX_effect_hover%5D%5Bsize%5D=&data%5Battribute%5D%5B_transform_scaleY_effect%5D%5Bunit%5D=px&data%5Battribute%5D%5B_transform_scaleY_effect%5D%5Bsize%5D=&data%5Battribute%5D%5B_transform_scaleY_effect_hover%5D%5Bunit%5D=px&data%5Battribute%5D%5B_transform_scaleY_effect_hover%5D%5Bsize%5D=&data%5Battribute%5D%5B_transform_skew_popover%5D=&data%5Battribute%5D%5B_transform_skewX_effect%5D%5Bunit%5D=px&data%5Battribute%5D%5B_transform_skewX_effect%5D%5Bsize%5D=&data%5Battribute%5D%5B_transform_skewX_effect_hover%5D%5Bunit%5D=deg&data%5Battribute%5D%5B_transform_skewX_effect_hover%5D%5Bsize%5D=&data%5Battribute%5D%5B_transform_skewY_effect%5D%5Bunit%5D=px&data%5Battribute%5D%5B_transform_skewY_effect%5D%5Bsize%5D=&data%5Battribute%5D%5B_transform_skewY_effect_hover%5D%5Bunit%5D=deg&data%5Battribute%5D%5B_transform_skewY_effect_hover%5D%5Bsize%5D=&data%5Battribute%5D%5B_transform_flipX_effect%5D=&data%5Battribute%5D%5B_transform_flipY_effect%5D=&data%5Battribute%5D%5B_transform_transition%5D%5Bunit%5D=px&data%5Battribute%5D%5B_transform_transition%5D%5Bsize%5D=&data%5Battribute%5D%5B_transform_transition_hover%5D%5Bunit%5D=px&data%5Battribute%5D%5B_transform_transition_hover%5D%5Bsize%5D=&data%5Battribute%5D%5Bmotion_fx_transform_x_anchor_point%5D=&data%5Battribute%5D%5Bmotion_fx_transform_y_anchor_point%5D=&data%5Battribute%5D%5B_background_background%5D=&data%5Battribute%5D%5B_background_gradient_notice%5D=&data%5Battribute%5D%5B_background_color%5D=&data%5Battribute%5D%5B_background_color_stop%5D%5Bunit%5D=%25&data%5Battribute%5D%5B_background_color_stop%5D%5Bsize%5D=0&data%5Battribute%5D%5B_background_color_b%5D=%23f2295b&data%5Battribute%5D%5B_background_color_b_stop%5D%5Bunit%5D=%25&data%5Battribute%5D%5B_background_color_b_stop%5D%5Bsize%5D=100&data%5Battribute%5D%5B_background_gradient_type%5D=linear&data%5Battribute%5D%5B_background_gradient_angle%5D%5Bunit%5D=deg&data%5Battribute%5D%5B_background_gradient_angle%5D%5Bsize%5D=180&data%5Battribute%5D%5B_background_gradient_position%5D=center+center&data%5Battribute%5D%5B_background_image%5D%5Burl%5D=&data%5Battribute%5D%5B_background_image%5D%5Bid%5D=&data%5Battribute%5D%5B_background_image%5D%5Bsize%5D=&data%5Battribute%5D%5B_background_position%5D=&data%5Battribute%5D%5B_background_xpos%5D%5Bunit%5D=px&data%5Battribute%5D%5B_background_xpos%5D%5Bsize%5D=0&data%5Battribute%5D%5B_background_ypos%5D%5Bunit%5D=px&data%5Battribute%5D%5B_background_ypos%5D%5Bsize%5D=0&data%5Battribute%5D%5B_background_attachment%5D=&data%5Battribute%5D%5B_background_repeat%5D=&data%5Battribute%5D%5B_background_size%5D=&data%5Battribute%5D%5B_background_bg_width%5D%5Bunit%5D=%25&data%5Battribute%5D%5B_background_bg_width%5D%5Bsize%5D=100&data%5Battribute%5D%5B_background_video_link%5D=&data%5Battribute%5D%5B_background_video_start%5D=&data%5Battribute%5D%5B_background_video_end%5D=&data%5Battribute%5D%5B_background_play_once%5D=&data%5Battribute%5D%5B_background_play_on_mobile%5D=&data%5Battribute%5D%5B_background_privacy_mode%5D=&data%5Battribute%5D%5B_background_video_fallback%5D%5Burl%5D=&data%5Battribute%5D%5B_background_video_fallback%5D%5Bid%5D=&data%5Battribute%5D%5B_background_video_fallback%5D%5Bsize%5D=&data%5Battribute%5D%5B_background_slideshow_loop%5D=yes&data%5Battribute%5D%5B_background_slideshow_slide_duration%5D=5000&data%5Battribute%5D%5B_background_slideshow_slide_transition%5D=fade&data%5Battribute%5D%5B_background_slideshow_transition_duration%5D=500&data%5Battribute%5D%5B_background_slideshow_background_size%5D=&data%5Battribute%5D%5B_background_slideshow_background_position%5D=&data%5Battribute%5D%5B_background_slideshow_lazyload%5D=&data%5Battribute%5D%5B_background_slideshow_ken_burns%5D=&data%5Battribute%5D%5B_background_slideshow_ken_burns_zoom_direction%5D=in&data%5Battribute%5D%5B_background_hover_background%5D=&data%5Battribute%5D%5B_background_hover_gradient_notice%5D=&data%5Battribute%5D%5B_background_hover_color%5D=&data%5Battribute%5D%5B_background_hover_color_stop%5D%5Bunit%5D=%25&data%5Battribute%5D%5B_background_hover_color_stop%5D%5Bsize%5D=0&data%5Battribute%5D%5B_background_hover_color_b%5D=%23f2295b&data%5Battribute%5D%5B_background_hover_color_b_stop%5D%5Bunit%5D=%25&data%5Battribute%5D%5B_background_hover_color_b_stop%5D%5Bsize%5D=100&data%5Battribute%5D%5B_background_hover_gradient_type%5D=linear&data%5Battribute%5D%5B_background_hover_gradient_angle%5D%5Bunit%5D=deg&data%5Battribute%5D%5B_background_hover_gradient_angle%5D%5Bsize%5D=180&data%5Battribute%5D%5B_background_hover_gradient_position%5D=center+center&data%5Battribute%5D%5B_background_hover_image%5D%5Burl%5D=&data%5Battribute%5D%5B_background_hover_image%5D%5Bid%5D=&data%5Battribute%5D%5B_background_hover_image%5D%5Bsize%5D=&data%5Battribute%5D%5B_background_hover_position%5D=&data%5Battribute%5D%5B_background_hover_xpos%5D%5Bunit%5D=px&data%5Battribute%5D%5B_background_hover_xpos%5D%5Bsize%5D=0&data%5Battribute%5D%5B_background_hover_ypos%5D%5Bunit%5D=px&data%5Battribute%5D%5B_background_hover_ypos%5D%5Bsize%5D=0&data%5Battribute%5D%5B_background_hover_attachment%5D=&data%5Battribute%5D%5B_background_hover_repeat%5D=&data%5Battribute%5D%5B_background_hover_size%5D=&data%5Battribute%5D%5B_background_hover_bg_width%5D%5Bunit%5D=%25&data%5Battribute%5D%5B_background_hover_bg_width%5D%5Bsize%5D=100&data%5Battribute%5D%5B_background_hover_video_link%5D=&data%5Battribute%5D%5B_background_hover_video_start%5D=&data%5Battribute%5D%5B_background_hover_video_end%5D=&data%5Battribute%5D%5B_background_hover_play_once%5D=&data%5Battribute%5D%5B_background_hover_play_on_mobile%5D=&data%5Battribute%5D%5B_background_hover_privacy_mode%5D=&data%5Battribute%5D%5B_background_hover_video_fallback%5D%5Burl%5D=&data%5Battribute%5D%5B_background_hover_video_fallback%5D%5Bid%5D=&data%5Battribute%5D%5B_background_hover_video_fallback%5D%5Bsize%5D=&data%5Battribute%5D%5B_background_hover_slideshow_loop%5D=yes&data%5Battribute%5D%5B_background_hover_slideshow_slide_duration%5D=5000&data%5Battribute%5D%5B_background_hover_slideshow_slide_transition%5D=fade&data%5Battribute%5D%5B_background_hover_slideshow_transition_duration%5D=500&data%5Battribute%5D%5B_background_hover_slideshow_background_size%5D=&data%5Battribute%5D%5B_background_hover_slideshow_background_position%5D=&data%5Battribute%5D%5B_background_hover_slideshow_lazyload%5D=&data%5Battribute%5D%5B_background_hover_slideshow_ken_burns%5D=&data%5Battribute%5D%5B_background_hover_slideshow_ken_burns_zoom_direction%5D=in&data%5Battribute%5D%5B_background_hover_transition%5D%5Bunit%5D=px&data%5Battribute%5D%5B_background_hover_transition%5D%5Bsize%5D=&data%5Battribute%5D%5B_border_border%5D=&data%5Battribute%5D%5B_border_width%5D%5Bunit%5D=px&data%5Battribute%5D%5B_border_width%5D%5Btop%5D=&data%5Battribute%5D%5B_border_width%5D%5Bright%5D=&data%5Battribute%5D%5B_border_width%5D%5Bbottom%5D=&data%5Battribute%5D%5B_border_width%5D%5Bleft%5D=&data%5Battribute%5D%5B_border_width%5D%5BisLinked%5D=true&data%5Battribute%5D%5B_border_color%5D=&data%5Battribute%5D%5B_border_radius%5D%5Bunit%5D=px&data%5Battribute%5D%5B_border_radius%5D%5Btop%5D=&data%5Battribute%5D%5B_border_radius%5D%5Bright%5D=&data%5Battribute%5D%5B_border_radius%5D%5Bbottom%5D=&data%5Battribute%5D%5B_border_radius%5D%5Bleft%5D=&data%5Battribute%5D%5B_border_radius%5D%5BisLinked%5D=true&data%5Battribute%5D%5B_box_shadow_box_shadow_type%5D=&data%5Battribute%5D%5B_box_shadow_box_shadow%5D%5Bhorizontal%5D=0&data%5Battribute%5D%5B_box_shadow_box_shadow%5D%5Bvertical%5D=0&data%5Battribute%5D%5B_box_shadow_box_shadow%5D%5Bblur%5D=10&data%5Battribute%5D%5B_box_shadow_box_shadow%5D%5Bspread%5D=0&data%5Battribute%5D%5B_box_shadow_box_shadow%5D%5Bcolor%5D=rgba(0%2C0%2C0%2C0.5)&data%5Battribute%5D%5B_box_shadow_box_shadow_position%5D=+&data%5Battribute%5D%5B_border_hover_border%5D=&data%5Battribute%5D%5B_border_hover_width%5D%5Bunit%5D=px&data%5Battribute%5D%5B_border_hover_width%5D%5Btop%5D=&data%5Battribute%5D%5B_border_hover_width%5D%5Bright%5D=&data%5Battribute%5D%5B_border_hover_width%5D%5Bbottom%5D=&data%5Battribute%5D%5B_border_hover_width%5D%5Bleft%5D=&data%5Battribute%5D%5B_border_hover_width%5D%5BisLinked%5D=true&data%5Battribute%5D%5B_border_hover_color%5D=&data%5Battribute%5D%5B_border_radius_hover%5D%5Bunit%5D=px&data%5Battribute%5D%5B_border_radius_hover%5D%5Btop%5D=&data%5Battribute%5D%5B_border_radius_hover%5D%5Bright%5D=&data%5Battribute%5D%5B_border_radius_hover%5D%5Bbottom%5D=&data%5Battribute%5D%5B_border_radius_hover%5D%5Bleft%5D=&data%5Battribute%5D%5B_border_radius_hover%5D%5BisLinked%5D=true&data%5Battribute%5D%5B_box_shadow_hover_box_shadow_type%5D=&data%5Battribute%5D%5B_box_shadow_hover_box_shadow%5D%5Bhorizontal%5D=0&data%5Battribute%5D%5B_box_shadow_hover_box_shadow%5D%5Bvertical%5D=0&data%5Battribute%5D%5B_box_shadow_hover_box_shadow%5D%5Bblur%5D=10&data%5Battribute%5D%5B_box_shadow_hover_box_shadow%5D%5Bspread%5D=0&data%5Battribute%5D%5B_box_shadow_hover_box_shadow%5D%5Bcolor%5D=rgba(0%2C0%2C0%2C0.5)&data%5Battribute%5D%5B_border_hover_transition%5D%5Bunit%5D=px&data%5Battribute%5D%5B_border_hover_transition%5D%5Bsize%5D=&data%5Battribute%5D%5B_mask_switch%5D=&data%5Battribute%5D%5B_mask_shape%5D=circle&data%5Battribute%5D%5B_mask_image%5D%5Burl%5D=&data%5Battribute%5D%5B_mask_image%5D%5Bid%5D=&data%5Battribute%5D%5B_mask_image%5D%5Bsize%5D=&data%5Battribute%5D%5B_mask_notice%5D=&data%5Battribute%5D%5B_mask_size%5D=contain&data%5Battribute%5D%5B_mask_size_scale%5D%5Bunit%5D=%25&data%5Battribute%5D%5B_mask_size_scale%5D%5Bsize%5D=100&data%5Battribute%5D%5B_mask_position%5D=center+center&data%5Battribute%5D%5B_mask_position_x%5D%5Bunit%5D=%25&data%5Battribute%5D%5B_mask_position_x%5D%5Bsize%5D=0&data%5Battribute%5D%5B_mask_position_y%5D%5Bunit%5D=%25&data%5Battribute%5D%5B_mask_position_y%5D%5Bsize%5D=0&data%5Battribute%5D%5B_mask_repeat%5D=no-repeat&data%5Battribute%5D%5Bhide_desktop%5D=&data%5Battribute%5D%5Bhide_tablet%5D=&data%5Battribute%5D%5Bhide_mobile%5D=&data%5Battribute%5D%5Bpaged%5D=1&data%5Battribute%5D%5Bcolumn_class%5D=jeg_col_2o3&data%5Battribute%5D%5Bclass%5D=jnews_block_3"
    
#         # 發出第一個 POST 請求
#         yield scrapy.Request(
#             url="https://www.koc.com.tw/", # 發出第一個請求到首頁，以取得首頁的原始 HTML
#             callback=self.parse_homepage,
#         )

#     def parse_homepage(self, response):
#         # 1. 處理首頁上方的文章區塊
#         for block in response.css('article.jeg_post'):
#             item = self.extract_article_info(block, response.url)
#             yield item

#         # 2. 開始模擬 AJAX 下拉加載
#         # 這裡從第 2 頁開始，因為第 1 頁已經在原始 HTML 中
#         current_page = 2
        
#         # 建立請求的 body 內容
#         body = f"lang=zh_TW&action=jnews_module_ajax_jnews_block_3&module=true&data[filter]=0&data[filter_type]=all&data[current_page]={current_page}&data[attribute][header_icon]=&data[attribute][first_title]=&data[attribute][second_title]=&data[attribute][url]=&data[attribute][header_type]=heading_6&data[attribute][header_background]=&data[attribute][header_secondary_background]=&data[attribute][header_text_color]=&data[attribute][header_line_color]=&data[attribute][header_accent_color]=&data[attribute][header_filter_category]=&data[attribute][header_filter_author]=&data[attribute][header_filter_tag]=&data[attribute][header_filter_text]=&data[attribute][sticky_post]=false&data[attribute][post_type]=post&data[attribute][content_type]=all&data[attribute][sponsor]=false&data[attribute][number_post]=12&data[attribute][post_offset]=0&data[attribute][unique_content]=disable&data[attribute][include_post]=&data[attribute][included_only]=false&data[attribute][exclude_post]=&data[attribute][include_category]=&data[attribute][exclude_category]=&data[attribute][include_author]=&data[attribute][include_tag]=&data[attribute][exclude_tag]=&data[attribute][sort_by]=latest&data[attribute][date_format]=default&data[attribute][date_format_custom]=Y/m/d&data[attribute][excerpt_length][unit]=px&data[attribute][excerpt_length][size]=45&data[attribute][excerpt_ellipsis]=...&data[attribute][force_normal_image_load]=&data[attribute][pagination_mode]=scrollload&data[attribute][pagination_nextprev_showtext]=&data[attribute][pagination_number_post][unit]=px&data[attribute][pagination_number_post][size]=12&data[attribute][pagination_scroll_limit]=36&data[attribute][ads_type]=disable&data[attribute][ads_position][unit]=px&data[attribute][ads_position][size]=1&data[attribute][ads_random]=&data[attribute][ads_image][url]=&data[attribute][ads_image][id]=&data[attribute][ads_image][size]=&data[attribute][ads_image_tablet][url]=&data[attribute][ads_image_tablet][id]=&data[attribute][ads_image_tablet][size]=&data[attribute][ads_image_phone][url]=&data[attribute][ads_image_phone][id]=&data[attribute][ads_image_phone][size]=&data[attribute][ads_image_link]=&data[attribute][ads_image_alt]=&data[attribute][ads_image_new_tab]=&data[attribute][google_publisher_id]=&data[attribute][google_slot_id]=&data[attribute][google_desktop]=auto&data[attribute][google_tab]=auto&data[attribute][google_phone]=auto&data[attribute][content]=&data[attribute][ads_bottom_text]=&data[attribute][boxed]=&data[attribute][boxed_shadow]=&data[attribute][el_id]=&data[attribute][el_class]=&data[attribute][scheme]=&data[attribute][column_width]=auto&data[attribute][title_color]=&data[attribute][accent_color]=&data[attribute][alt_color]=&data[attribute][excerpt_color]=&data[attribute][css]=&data[attribute][title_typography_typography]=&data[attribute][title_typography_font_family]=&data[attribute][title_typography_font_size][unit]=px&data[attribute][title_typography_font_size][size]=&data[attribute][title_typography_font_weight]=&data[attribute][title_typography_text_transform]=&data[attribute][title_typography_font_style]=&data[attribute][title_typography_text_decoration]=&data[attribute][title_typography_line_height][unit]=px&data[attribute][title_typography_line_height][size]=&data[attribute][title_typography_letter_spacing][unit]=px&data[attribute][title_typography_letter_spacing][size]=&data[attribute][title_typography_word_spacing][unit]=px&data[attribute][title_typography_word_spacing][size]=&data[attribute][meta_typography_typography]=&data[attribute][meta_typography_font_family]=&data[attribute][meta_typography_font_size][unit]=px&data[attribute][meta_typography_font_size][size]=&data[attribute][meta_typography_font_weight]=&data[attribute][meta_typography_text_transform]=&data[attribute][meta_typography_font_style]=&data[attribute][meta_typography_text_decoration]=&data[attribute][meta_typography_line_height][unit]=px&data[attribute][meta_typography_line_height][size]=&data[attribute][meta_typography_letter_spacing][unit]=px&data[attribute][meta_typography_letter_spacing][size]=&data[attribute][meta_typography_word_spacing][unit]=px&data[attribute][meta_typography_word_spacing][size]=&data[attribute][content_typography_typography]=&data[attribute][content_typography_font_family]=&data[attribute][content_typography_font_size][unit]=px&data[attribute][content_typography_font_size][size]=&data[attribute][content_typography_font_weight]=&data[attribute][content_typography_text_transform]=&data[attribute][content_typography_font_style]=&data[attribute][content_typography_text_decoration]=&data[attribute][content_typography_line_height][unit]=px&data[attribute][content_typography_line_height][size]=&data[attribute][content_typography_letter_spacing][unit]=px&data[attribute][content_typography_letter_spacing][size]=&data[attribute][content_typography_word_spacing][unit]=px&data[attribute][content_typography_word_spacing][size]=&data[attribute][ads_type_hover]=&data[attribute][ads_position_hover][unit]=px&data[attribute][ads_position_hover][size]=1&data[attribute][ads_random_hover]=&data[attribute][ads_image_hover][url]=&data[attribute][ads_image_hover][id]=&data[attribute][ads_image_hover][size]=&data[attribute][ads_image_tablet_hover][url]=&data[attribute][ads_image_tablet_hover][id]=&data[attribute][ads_image_tablet_hover][size]=&data[attribute][ads_image_phone_hover][url]=&data[attribute][ads_image_phone_hover][id]=&data[attribute][ads_image_phone_hover][size]=&data[attribute][ads_image_link_hover]=&data[attribute][ads_image_alt_hover]=&data[attribute][ads_image_new_tab_hover]=&data[attribute][google_publisher_id_hover]=&data[attribute][google_slot_id_hover]=&data[attribute][google_desktop_hover]=auto&data[attribute][google_tab_hover]=auto&data[attribute][google_phone_hover]=auto&data[attribute][content_hover]=&data[attribute][ads_bottom_text_hover]=&data[attribute][boxed_hover]=&data[attribute][boxed_shadow_hover]=&data[attribute][el_id_hover]=&data[attribute][el_class_hover]=&data[attribute][scheme_hover]=&data[attribute][column_width_hover]=auto&data[attribute][title_color_hover]=&data[attribute][accent_color_hover]=&data[attribute][alt_color_hover]=&data[attribute][excerpt_color_hover]=&data[attribute][css_hover]=&data[attribute][title_typography_typography_hover]=&data[attribute][title_typography_font_family_hover]=&data[attribute][title_typography_font_size_hover][unit]=px&data[attribute][title_typography_font_size_hover][size]=&data[attribute][title_typography_font_weight_hover]=&data[attribute][title_typography_text_transform_hover]=&data[attribute][title_typography_font_style_hover]=&data[attribute][title_typography_text_decoration_hover]=&data[attribute][title_typography_line_height_hover][unit]=px&data[attribute][title_typography_line_height_hover][size]=&data[attribute][title_typography_letter_spacing_hover][unit]=px&data[attribute][title_typography_letter_spacing_hover][size]=&data[attribute][title_typography_word_spacing_hover][unit]=px&data[attribute][title_typography_word_spacing_hover][size]=&data[attribute][meta_typography_typography_hover]=&data[attribute][meta_typography_font_family_hover]=&data[attribute][meta_typography_font_size_hover][unit]=px&data[attribute][meta_typography_font_size_hover][size]=&data[attribute][meta_typography_font_weight_hover]=&data[attribute][meta_typography_text_transform_hover]=&data[attribute][meta_typography_font_style_hover]=&data[attribute][meta_typography_text_decoration_hover]=&data[attribute][meta_typography_line_height_hover][unit]=px&data[attribute][meta_typography_line_height_hover][size]=&data[attribute][meta_typography_letter_spacing_hover][unit]=px&data[attribute][meta_typography_letter_spacing_hover][size]=&data[attribute][meta_typography_word_spacing_hover][unit]=px&data[attribute][meta_typography_word_spacing_hover][size]=&data[attribute][content_typography_typography_hover]=&data[attribute][content_typography_font_family_hover]=&data[attribute][content_typography_font_size_hover][unit]=px&data[attribute][content_typography_font_size_hover][size]=&data[attribute][content_typography_font_weight_hover]=&data[attribute][content_typography_text_transform_hover]=&data[attribute][content_typography_font_style_hover]=&data[attribute][content_typography_text_decoration_hover]=&data[attribute][content_typography_line_height_hover][unit]=px&data[attribute][content_typography_line_height_hover][size]=&data[attribute][content_typography_letter_spacing_hover][unit]=px&data[attribute][content_typography_letter_spacing_hover][size]=&data[attribute][content_typography_word_spacing_hover][unit]=px&data[attribute][content_typography_word_spacing_hover][size]=&data[attribute][ads_type_hover]=&data[attribute][ads_position_hover][unit]=px&data[attribute][ads_position_hover][size]=1&data[attribute][ads_random_hover]=&data[attribute][ads_image_hover][url]=&data[attribute][ads_image_hover][id]=&data[attribute][ads_image_hover][size]=&data[attribute][ads_image_tablet_hover][url]=&data[attribute][ads_image_tablet_hover][id]=&data[attribute][ads_image_tablet_hover][size]=&data[attribute][ads_image_phone_hover][url]=&data[attribute][ads_image_phone_hover][id]=&data[attribute][ads_image_phone_hover][size]=&data[attribute][ads_image_link_hover]=&data[attribute][ads_image_alt_hover]=&data[attribute][ads_image_new_tab_hover]=&data[attribute][google_publisher_id_hover]=&data[attribute][google_slot_id_hover]=&data[attribute][google_desktop_hover]=auto&data[attribute][google_tab_hover]=auto&data[attribute][google_phone_hover]=auto&data[attribute][content_hover]=&data[attribute][ads_bottom_text_hover]=&data[attribute][boxed_hover]=&data[attribute][boxed_shadow_hover]=&data[attribute][el_id_hover]=&data[attribute][el_class_hover]=&data[attribute][scheme_hover]=&data[attribute][column_width_hover]=auto&data[attribute][title_color_hover]=&data[attribute][accent_color_hover]=&data[attribute][alt_color_hover]=&data[attribute][excerpt_color_hover]=&data[attribute][css_hover]=&data[attribute][title_typography_typography_hover]=&data[attribute][title_typography_font_family_hover]=&data[attribute][title_typography_font_size_hover][unit]=px&data[attribute][title_typography_font_size_hover][size]=&data[attribute][title_typography_font_weight_hover]=&data[attribute][title_typography_text_transform_hover]=&data[attribute][title_typography_font_style_hover]=&data[attribute][title_typography_text_decoration_hover]=&data[attribute][title_typography_line_height_hover][unit]=px&data[attribute][title_typography_line_height_hover][size]=&data[attribute][title_typography_letter_spacing_hover][unit]=px&data[attribute][title_typography_letter_spacing_hover][size]=&data[attribute][title_typography_word_spacing_hover][unit]=px&data[attribute][title_typography_word_spacing_hover][size]=&data[attribute][_title_hover]=&data[attribute][_margin_hover][unit]=px&data[attribute][_margin_hover][top]=&data[attribute][_margin_hover][right]=&data[attribute][_margin_hover][bottom]=&data[attribute][_margin_hover][left]=&data[attribute][_margin_hover][isLinked]=true&data[attribute][_padding_hover][unit]=px&data[attribute][_padding_hover][top]=&data[attribute][_padding_hover][right]=&data[attribute][_padding_hover][bottom]=&data[attribute][_padding_hover][left]=&data[attribute][_padding_hover][isLinked]=true&data[attribute][_element_width_hover]=&data[attribute][_element_width_tablet_hover]=&data[attribute][_element_width_mobile_hover]=&data[attribute][_element_custom_width_hover][unit]=%25&data[attribute][_element_custom_width_hover][size]=&data[attribute][_element_vertical_align_hover]=&data[attribute][_position_description_hover]=&data[attribute][_position_hover]=&data[attribute][_offset_orientation_h_hover]=start&data[attribute][_offset_x_hover][unit]=px&data[attribute][_offset_x_hover][size]=0&data[attribute][_offset_x_end_hover][unit]=px&data[attribute][_offset_x_end_hover][size]=0&data[attribute][_offset_orientation_v_hover]=start&data[attribute][_offset_y_hover][unit]=px&data[attribute][_offset_y_hover][size]=0&data[attribute][_offset_y_end_hover][unit]=px&data[attribute][_offset_y_end_hover][size]=0&data[attribute][_z_index_hover]=&data[attribute][_element_id_hover]=&data[attribute][_css_classes_hover]=&data[attribute][_animation_hover]=&data[attribute][_animation_tablet_hover]=&data[attribute][_animation_mobile_hover]=&data[attribute][animation_duration_hover]=&data[attribute][_animation_delay_hover]=&data[attribute][_transform_rotate_popover_hover]=&data[attribute][_transform_rotateZ_effect_hover][unit]=px&data[attribute][_transform_rotateZ_effect_hover][size]=&data[attribute][_transform_rotateZ_effect_hover_tablet][unit]=deg&data[attribute][_transform_rotateZ_effect_hover_tablet][size]=&data[attribute][_transform_rotateZ_effect_hover_mobile][unit]=deg&data[attribute][_transform_rotateZ_effect_hover_mobile][size]=&data[attribute][_transform_rotate_3d_hover]=&data[attribute][_transform_rotateX_effect_hover][unit]=px&data[attribute][_transform_rotateX_effect_hover][size]=&data[attribute][_transform_rotateX_effect_hover_tablet][unit]=deg&data[attribute][_transform_rotateX_effect_hover_tablet][size]=&data[attribute][_transform_rotateX_effect_hover_mobile][unit]=deg&data[attribute][_transform_rotateX_effect_hover_mobile][size]=&data[attribute][_transform_rotateY_effect_hover][unit]=px&data[attribute][_transform_rotateY_effect_hover][size]=&data[attribute][_transform_rotateY_effect_hover_tablet][unit]=deg&data[attribute][_transform_rotateY_effect_hover_tablet][size]=&data[attribute][_transform_rotateY_effect_hover_mobile][unit]=deg&data[attribute][_transform_rotateY_effect_hover_mobile][size]=&data[attribute][_transform_perspective_effect_hover][unit]=px&data[attribute][_transform_perspective_effect_hover][size]=&data[attribute][_transform_perspective_effect_hover_tablet][unit]=px&data[attribute][_transform_perspective_effect_hover_tablet][size]=&data[attribute][_transform_perspective_effect_hover_mobile][unit]=px&data[attribute][_transform_perspective_effect_hover_mobile][size]=&data[attribute][_transform_translate_popover_hover]=&data[attribute][_transform_translateX_effect_hover][unit]=px&data[attribute][_transform_translateX_effect_hover][size]=&data[attribute][_transform_translateX_effect_hover_tablet][unit]=px&data[attribute][_transform_translateX_effect_hover_tablet][size]=&data[attribute][_transform_translateX_effect_hover_mobile][unit]=px&data[attribute][_transform_translateX_effect_hover_mobile][size]=&data[attribute][_transform_translateY_effect_hover][unit]=px&data[attribute][_transform_translateY_effect_hover][size]=&data[attribute][_transform_translateY_effect_hover_tablet][unit]=px&data[attribute][_transform_translateY_effect_hover_tablet][size]=&data[attribute][_transform_translateY_effect_hover_mobile][unit]=px&data[attribute][_transform_translateY_effect_hover_mobile][size]=&data[attribute][_transform_scale_popover_hover]=&data[attribute][_transform_keep_proportions_hover]=yes&data[attribute][_transform_scale_effect_hover][unit]=px&data[attribute][_transform_scale_effect_hover][size]=&data[attribute][_transform_scaleX_effect_hover][unit]=px&data[attribute][_transform_scaleX_effect_hover][size]=&data[attribute][_transform_scaleY_effect_hover][unit]=px&data[attribute][_transform_scaleY_effect_hover][size]=&data[attribute][_transform_skew_popover_hover]=&data[attribute][_transform_skewX_effect_hover][unit]=px&data[attribute][_transform_skewX_effect_hover][size]=&data[attribute][_transform_skewY_effect_hover][unit]=px&data[attribute][_transform_skewY_effect_hover][size]=&data[attribute][_transform_flipX_effect_hover]=&data[attribute][_transform_flipY_effect_hover]=&data[attribute][_transform_transition_hover][unit]=px&data[attribute][_transform_transition_hover][size]=&data[attribute][motion_fx_transform_x_anchor_point_hover]=&data[attribute][motion_fx_transform_y_anchor_point_hover]=&data[attribute][_background_background_hover]=&data[attribute][_background_gradient_notice_hover]=&data[attribute][_background_color_hover]=&data[attribute][_background_color_stop_hover][unit]=%25&data[attribute][_background_color_stop_hover][size]=0&data[attribute][_background_color_b_hover]=%23f2295b&data[attribute][_background_color_b_hover_stop][unit]=%25&data[attribute][_background_color_b_hover_stop][size]=100&data[attribute][_background_gradient_type_hover]=linear&data[attribute][_background_gradient_angle_hover][unit]=deg&data[attribute][_background_gradient_angle_hover][size]=180&data[attribute][_background_gradient_position_hover]=center+center&data[attribute][_background_image_hover][url]=&data[attribute][_background_image_hover][id]=&data[attribute][_background_image_hover][size]=&data[attribute][_background_position_hover]=&data[attribute][_background_xpos_hover][unit]=px&data[attribute][_background_xpos_hover][size]=0&data[attribute][_background_ypos_hover][unit]=px&data[attribute][_background_ypos_hover][size]=0&data[attribute][_background_attachment_hover]=&data[attribute][_background_repeat_hover]=&data[attribute][_background_size_hover]=&data[attribute][_background_bg_width_hover][unit]=%25&data[attribute][_background_bg_width_hover][size]=100&data[attribute][_background_video_link_hover]=&data[attribute][_background_video_start_hover]=&data[attribute][_background_video_end_hover]=&data[attribute][_background_video_play_once_hover]=&data[attribute][_background_video_play_on_mobile_hover]=&data[attribute][_background_video_privacy_mode_hover]=&data[attribute][_background_video_fallback_hover][url]=&data[attribute][_background_video_fallback_hover][id]=&data[attribute][_background_video_fallback_hover][size]=&data[attribute][_background_slideshow_loop_hover]=yes&data[attribute][_background_slideshow_slide_duration_hover]=5000&data[attribute][_background_slideshow_slide_transition_hover]=fade&data[attribute][_background_slideshow_transition_duration_hover]=500&data[attribute][_background_slideshow_background_size_hover]=&data[attribute][_background_slideshow_background_position_hover]=&data[attribute][_background_slideshow_lazyload_hover]=&data[attribute][_background_slideshow_ken_burns_hover]=&data[attribute][_background_slideshow_ken_burns_zoom_direction_hover]=in&data[attribute][_background_hover_transition]=&data[attribute][_border_border_hover]=&data[attribute][_border_width_hover][unit]=px&data[attribute][_border_width_hover][top]=&data[attribute][_border_width_hover][right]=&data[attribute][_border_width_hover][bottom]=&data[attribute][_border_width_hover][left]=&data[attribute][_border_width_hover][isLinked]=true&data[attribute][_border_color_hover]=&data[attribute][_border_radius_hover][unit]=px&data[attribute][_border_radius_hover][top]=&data[attribute][_border_radius_hover][right]=&data[attribute][_border_radius_hover][bottom]=&data[attribute][_border_radius_hover][left]=&data[attribute][_border_radius_hover][isLinked]=true&data[attribute][_box_shadow_hover_box_shadow_type]=&data[attribute][_box_shadow_hover_box_shadow][horizontal]=0&data[attribute][_box_shadow_hover_box_shadow][vertical]=0&data[attribute][_box_shadow_hover_box_shadow][blur]=10&data[attribute][_box_shadow_hover_box_shadow][spread]=0&data[attribute][_box_shadow_hover_box_shadow][color]=rgba(0,0,0,0.5)&data[attribute][_box_shadow_hover_box_shadow_position]=&data[attribute][_border_hover_transition]=&data[attribute][_mask_switch_hover]=&data[attribute][_mask_shape_hover]=circle&data[attribute][_mask_image_hover][url]=&data[attribute][_mask_image_hover][id]=&data[attribute][_mask_image_hover][size]=&data[attribute][_mask_notice_hover]=&data[attribute][_mask_size_hover]=contain&data[attribute][_mask_size_scale_hover][unit]=%25&data[attribute][_mask_size_scale_hover][size]=100&data[attribute][_mask_position_hover]=center+center&data[attribute][_mask_position_x_hover][unit]=%25&data[attribute][_mask_position_x_hover][size]=0&data[attribute][_mask_position_y_hover][unit]=%25&data[attribute][_mask_position_y_hover][size]=0&data[attribute][_mask_repeat_hover]=no-repeat&data[attribute][_ads_bottom_text]=&data[attribute][_element_id]=&data[attribute][_css_classes]=&data[attribute][_animation]=&data[attribute][_animation_tablet]=&data[attribute][_animation_mobile]=&data[attribute][animation_duration]=&data[attribute][_animation_delay]=&data[attribute][_transform_rotate_popover]=&data[attribute][_transform_rotateZ_effect][unit]=px&data[attribute][_transform_rotateZ_effect][size]=&data[attribute][_transform_rotateZ_effect_tablet][unit]=deg&data[attribute][_transform_rotateZ_effect_tablet][size]=&data[attribute][_transform_rotateZ_effect_mobile][unit]=deg&data[attribute][_transform_rotateZ_effect_mobile][size]=&data[attribute][_transform_rotate_3d]=&data[attribute][_transform_rotateX_effect][unit]=px&data[attribute][_transform_rotateX_effect][size]=&data[attribute][_transform_rotateX_effect_tablet][unit]=deg&data[attribute][_transform_rotateX_effect_tablet][size]=&data[attribute][_transform_rotateX_effect_mobile][unit]=deg&data[attribute][_transform_rotateX_effect_mobile][size]=&data[attribute][_transform_rotateY_effect][unit]=px&data[attribute][_transform_rotateY_effect][size]=&data[attribute][_transform_rotateY_effect_tablet][unit]=deg&data[attribute][_transform_rotateY_effect_tablet][size]=&data[attribute][_transform_rotateY_effect_mobile][unit]=deg&data[attribute][_transform_rotateY_effect_mobile][size]=&data[attribute][_transform_perspective_effect][unit]=px&data[attribute][_transform_perspective_effect][size]=&data[attribute][_transform_perspective_effect_tablet][unit]=px&data[attribute][_transform_perspective_effect_tablet][size]=&data[attribute][_transform_perspective_effect_mobile][unit]=px&data[attribute][_transform_perspective_effect_mobile][size]=&data[attribute][_transform_translate_popover]=&data[attribute][_transform_translateX_effect][unit]=px&data[attribute][_transform_translateX_effect][size]=&data[attribute][_transform_translateX_effect_tablet][unit]=px&data[attribute][_transform_translateX_effect_tablet][size]=&data[attribute][_transform_translateX_effect_mobile][unit]=px&data[attribute][_transform_translateX_effect_mobile][size]=&data[attribute][_transform_translateY_effect][unit]=px&data[attribute][_transform_translateY_effect][size]=&data[attribute][_transform_translateY_effect_tablet][unit]=px&data[attribute][_transform_translateY_effect_tablet][size]=&data[attribute][_transform_translateY_effect_mobile][unit]=px&data[attribute][_transform_translateY_effect_mobile][size]=&data[attribute][_transform_scale_popover]=&data[attribute][_transform_keep_proportions]=yes&data[attribute][_transform_scale_effect][unit]=px&data[attribute][_transform_scale_effect][size]=&data[attribute][_transform_scale_effect_hover][unit]=px&data[attribute][_transform_scale_effect_hover][size]=&data[attribute][_transform_scaleX_effect][unit]=px&data[attribute][_transform_scaleX_effect][size]=&data[attribute][_transform_scaleX_effect_hover][unit]=px&data[attribute][_transform_scaleX_effect_hover][size]=&data[attribute][_transform_scaleY_effect][unit]=px&data[attribute][_transform_scaleY_effect][size]=&data[attribute][_transform_scaleY_effect_hover][unit]=px&data[attribute][_transform_scaleY_effect_hover][size]=&data[attribute][_transform_skew_popover]=&data[attribute][_transform_skewX_effect][unit]=px&data[attribute][_transform_skewX_effect][size]=&data[attribute][_transform_skewX_effect_hover][unit]=deg&data[attribute][_transform_skewX_effect_hover][size]=&data[attribute][_transform_skewY_effect][unit]=px&data[attribute][_transform_skewY_effect][size]=&data[attribute][_transform_skewY_effect_hover][unit]=deg&data[attribute][_transform_skewY_effect_hover][size]=&data[attribute][_transform_flipX_effect]=&data[attribute][_transform_flipY_effect]=&data[attribute][_transform_transition][unit]=px&data[attribute][_transform_transition][size]=&data[attribute][_transform_transition_hover][unit]=px&data[attribute][_transform_transition_hover][size]=&data[attribute][motion_fx_transform_x_anchor_point]=&data[attribute][motion_fx_transform_y_anchor_point]=&data[attribute][_background_background]=&data[attribute][_background_gradient_notice]=&data[attribute][_background_color]=&data[attribute][_background_color_stop][unit]=%25&data[attribute][_background_color_stop][size]=0&data[attribute][_background_color_b]=%23f2295b&data[attribute][_background_color_b_stop][unit]=%25&data[attribute][_background_color_b_stop][size]=100&data[attribute][_background_gradient_type]=linear&data[attribute][_background_gradient_angle][unit]=deg&data[attribute][_background_gradient_angle][size]=180&data[attribute][_background_gradient_position]=center+center&data[attribute][_background_image][url]=&data[attribute][_background_image][id]=&data[attribute][_background_image][size]=&data[attribute][_background_position]=&data[attribute][_background_xpos][unit]=px&data[attribute][_background_xpos][size]=0&data[attribute][_background_ypos][unit]=px&data[attribute][_background_ypos][size]=0&data[attribute][_background_attachment]=&data[attribute][_background_repeat]=&data[attribute][_background_size]=&data[attribute][_background_bg_width][unit]=%25&data[attribute][_background_bg_width][size]=100&data[attribute][_background_video_link]=&data[attribute][_background_video_start]=&data[attribute][_background_video_end]=&data[attribute][_background_video_play_once]=&data[attribute][_background_video_play_on_mobile]=&data[attribute][_background_video_privacy_mode]=&data[attribute][_background_video_fallback][url]=&data[attribute][_background_video_fallback][id]=&data[attribute][_background_video_fallback][size]=&data[attribute][_background_slideshow_loop]=yes&data[attribute][_background_slideshow_slide_duration]=5000&data[attribute][_background_slideshow_slide_transition]=fade&data[attribute][_background_slideshow_transition_duration]=500&data[attribute][_background_slideshow_background_size]=&data[attribute][_background_slideshow_background_position]=&data[attribute][_background_slideshow_lazyload]=&data[attribute][_background_slideshow_ken_burns]=&data[attribute][_background_slideshow_ken_burns_zoom_direction]=in&data[attribute][_background_hover_background]=&data[attribute][_background_hover_gradient_notice]=&data[attribute][_background_hover_color]=&data[attribute][_background_hover_color_stop][unit]=%25&data[attribute][_background_hover_color_stop][size]=0&data[attribute][_background_hover_color_b]=%23f2295b&data[attribute][_background_hover_color_b_stop][unit]=%25&data[attribute][_background_hover_color_b_stop][size]=100&data[attribute][_background_hover_gradient_type]=linear&data[attribute][_background_hover_gradient_angle][unit]=deg&data[attribute][_background_hover_gradient_angle][size]=180&data[attribute][_background_hover_gradient_position]=center+center&data[attribute][_background_hover_image][url]=&data[attribute][_background_hover_image][id]=&data[attribute][_background_hover_image][size]=&data[attribute][_background_hover_position]=&data[attribute][_background_hover_xpos][unit]=px&data[attribute][_background_hover_xpos][size]=0&data[attribute][_background_hover_ypos][unit]=px&data[attribute][_background_hover_ypos][size]=0&data[attribute][_background_hover_attachment]=&data[attribute][_background_hover_repeat]=&data[attribute][_background_hover_size]=&data[attribute][_background_hover_bg_width][unit]=%25&data[attribute][_background_hover_bg_width][size]=100&data[attribute][_background_hover_video_link]=&data[attribute][_background_hover_video_start]=&data[attribute][_background_hover_video_end]=&data[attribute][_background_hover_video_play_once]=&data[attribute][_background_hover_video_play_on_mobile]=&data[attribute][_background_hover_video_privacy_mode]=&data[attribute][_background_hover_video_fallback][url]=&data[attribute][_background_hover_video_fallback][id]=&data[attribute][_background_hover_video_fallback][size]=&data[attribute][_background_hover_slideshow_loop]=yes&data[attribute][_background_hover_slideshow_slide_duration]=5000&data[attribute][_background_hover_slideshow_slide_transition]=fade&data[attribute][_background_hover_slideshow_transition_duration]=500&data[attribute][_background_hover_slideshow_background_size]=&data[attribute][_background_hover_slideshow_background_position]=&data[attribute][_background_hover_slideshow_lazyload]=&data[attribute][_background_hover_slideshow_ken_burns]=&data[attribute][_background_hover_slideshow_ken_burns_zoom_direction]=in&data[attribute][_background_hover_transition]=&data[attribute][_border_border_hover]=&data[attribute][_border_width_hover][unit]=px&data[attribute][_border_width_hover][top]=&data[attribute][_border_width_hover][right]=&data[attribute][_border_width_hover][bottom]=&data[attribute][_border_width_hover][left]=&data[attribute][_border_hover_width_hover]=&data[attribute][_border_hover_width_hover][unit]=px&data[attribute][_border_hover_width_hover][top]=&data[attribute][_border_hover_width_hover][right]=&data[attribute][_border_hover_width_hover][bottom]=&data[attribute][_border_hover_width_hover][left]=&data[attribute][_border_hover_width_hover][isLinked]=true&data[attribute][_border_hover_color]=&data[attribute][_border_radius_hover]=&data[attribute][_border_radius_hover][unit]=px&data[attribute][_border_radius_hover][top]=&data[attribute][_border_radius_hover][right]=&data[attribute][_border_radius_hover][bottom]=&data[attribute][_border_radius_hover][left]=&data[attribute][_border_radius_hover][isLinked]=true&data[attribute][_box_shadow_hover_box_shadow_type]=&data[attribute][_box_shadow_hover_box_shadow]=&data[attribute][_box_shadow_hover_box_shadow][horizontal]=0&data[attribute][_box_shadow_hover_box_shadow][vertical]=0&data[attribute][_box_shadow_hover_box_shadow][blur]=10&data[attribute][_box_shadow_hover_box_shadow][spread]=0&data[attribute][_box_shadow_hover_box_shadow][color]=rgba(0,0,0,0.5)&data[attribute][_box_shadow_hover_box_shadow_position]=&data[attribute][_border_hover_transition]=&data[attribute][_mask_switch_hover]=&data[attribute][_mask_shape_hover]=circle&data[attribute][_mask_image_hover]=&data[attribute][_mask_image_hover][url]=&data[attribute][_mask_image_hover][id]=&data[attribute][_mask_image_hover][size]=&data[attribute][_mask_notice_hover]=&data[attribute][_mask_size_hover]=contain&data[attribute][_mask_size_scale_hover][unit]=%25&data[attribute][_mask_size_scale_hover][size]=100&data[attribute][_mask_position_hover]=center+center&data[attribute][_mask_position_x_hover][unit]=%25&data[attribute][_mask_position_x_hover][size]=0&data[attribute][_mask_position_y_hover][unit]=%25&data[attribute][_mask_position_y_hover][size]=0&data[attribute][_mask_repeat_hover]=no-repeat"
        
#         # 發出第一個 POST 請求
#         yield scrapy.Request(
#             url="https://www.koc.com.tw/?ajax-request=jnews",
#             method='POST',
#             headers={'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8'},
#             body=body,
#             meta={'page': current_page},
#             callback=self.parse_ajax_response
#         )

#     def extract_article_info(self, selector, base_url):
#         # 這是從 HTML 片段中提取資訊的通用方法
#         item = ArticleItem()
#         href = selector.css('h3.jeg_post_title a::attr(href)').get()
#         item["url"] = urljoin(base_url, href) if href else ""
#         item["title"] = selector.css('h3.jeg_post_title a::text').get(default="").strip()
#         item["author"] = selector.css('.jeg_meta_author a::text').get(default="").strip()
#         pub_text = selector.css('.jeg_meta_date a::text').get()
#         item["published_at"] = pub_text.strip() if pub_text else ""
        
#         # 這裡因為 AJAX 請求的回應沒有完整的內文，所以 content 設為摘要
#         excerpt = selector.css('.jeg_post_excerpt p::text').getall()
#         item["content"] = "\n".join([p.strip() for p in excerpt if p.strip()])
#         return item

#     def parse_ajax_response(self, response):
#         page = response.meta['page']
        
#         # 解析 JSON 回應
#         try:
#             data = response.json()
#         except ValueError:
#             self.logger.error(f"Failed to parse JSON for page {page}")
#             return

#         # 檢查 JSON 中是否有 'template' 鍵，它包含了 HTML 片段
#         if 'template' in data and data['template'].strip():
#             html_content = data['template']
#             selector = scrapy.Selector(text=html_content)
            
#             # 從 HTML 片段中提取文章區塊
#             articles = selector.css('article.jeg_post')
            
#             # 如果 articles 是空的，表示沒有更多內容
#             if not articles:
#                 self.logger.info(f"No more articles found on page {page}. Stopping.")
#                 return

#             # 處理每一篇文章
#             for article in articles:
#                 item = self.extract_article_info(article, "https://www.koc.com.tw/")
#                 yield item
            
#             # 遞迴抓取下一頁
#             next_page = page + 1
#             body = f"lang=zh_TW&action=jnews_module_ajax_jnews_block_3&module=true&data[filter]=0&data[filter_type]=all&data[current_page]={next_page}&data[attribute][header_icon]=&data[attribute][first_title]=&data[attribute][second_title]=&data[attribute][url]=&data[attribute][header_type]=heading_6&data[attribute][header_background]=&data[attribute][header_secondary_background]=&data[attribute][header_text_color]=&data[attribute][header_line_color]=&data[attribute][header_accent_color]=&data[attribute][header_filter_category]=&data[attribute][header_filter_author]=&data[attribute][header_filter_tag]=&data[attribute][header_filter_text]=&data[attribute][sticky_post]=false&data[attribute][post_type]=post&data[attribute][content_type]=all&data[attribute][sponsor]=false&data[attribute][number_post]=12&data[attribute][post_offset]=0&data[attribute][unique_content]=disable&data[attribute][include_post]=&data[attribute][included_only]=false&data[attribute][exclude_post]=&data[attribute][include_category]=&data[attribute][exclude_category]=&data[attribute][include_author]=&data[attribute][include_tag]=&data[attribute][exclude_tag]=&data[attribute][sort_by]=latest&data[attribute][date_format]=default&data[attribute][date_format_custom]=Y/m/d&data[attribute][excerpt_length][unit]=px&data[attribute][excerpt_length][size]=45&data[attribute][excerpt_ellipsis]=...&data[attribute][force_normal_image_load]=&data[attribute][pagination_mode]=scrollload&data[attribute][pagination_nextprev_showtext]=&data[attribute][pagination_number_post][unit]=px&data[attribute][pagination_number_post][size]=12&data[attribute][pagination_scroll_limit]=36&data[attribute][ads_type]=disable&data[attribute][ads_position][unit]=px&data[attribute][ads_position][size]=1&data[attribute][ads_random]=&data[attribute][ads_image][url]=&data[attribute][ads_image][id]=&data[attribute][ads_image][size]=&data[attribute][ads_image_tablet][url]=&data[attribute][ads_image_tablet][id]=&data[attribute][ads_image_tablet][size]=&data[attribute][ads_image_phone][url]=&data[attribute][ads_image_phone][id]=&data[attribute][ads_image_phone][size]=&data[attribute][ads_image_link]=&data[attribute][ads_image_alt]=&data[attribute][ads_image_new_tab]=&data[attribute][google_publisher_id]=&data[attribute][google_slot_id]=&data[attribute][google_desktop]=auto&data[attribute][google_tab]=auto&data[attribute][google_phone]=auto&data[attribute][content]=&data[attribute][ads_bottom_text]=&data[attribute][boxed]=&data[attribute][boxed_shadow]=&data[attribute][el_id]=&data[attribute][el_class]=&data[attribute][scheme]=&data[attribute][column_width]=auto&data[attribute][title_color]=&data[attribute][accent_color]=&data[attribute][alt_color]=&data[attribute][excerpt_color]=&data[attribute][css]=&data[attribute][title_typography_typography]=&data[attribute][title_typography_font_family]=&data[attribute][title_typography_font_size][unit]=px&data[attribute][title_typography_font_size][size]=&data[attribute][title_typography_font_weight]=&data[attribute][title_typography_text_transform]=&data[attribute][title_typography_font_style]=&data[attribute][title_typography_text_decoration]=&data[attribute][title_typography_line_height][unit]=px&data[attribute][title_typography_line_height][size]=&data[attribute][title_typography_letter_spacing][unit]=px&data[attribute][title_typography_letter_spacing][size]=&data[attribute][title_typography_word_spacing][unit]=px&data[attribute][title_typography_word_spacing][size]=&data[attribute][meta_typography_typography]=&data[attribute][meta_typography_font_family]=&data[attribute][meta_typography_font_size][unit]=px&data[attribute][meta_typography_font_size][size]=&data[attribute][meta_typography_font_weight]=&data[attribute][meta_typography_text_transform]=&data[attribute][meta_typography_font_style]=&data[attribute][meta_typography_text_decoration]=&data[attribute][meta_typography_line_height][unit]=px&data[attribute][meta_typography_line_height][size]=&data[attribute][meta_typography_letter_spacing][unit]=px&data[attribute][meta_typography_letter_spacing][size]=&data[attribute][meta_typography_word_spacing][unit]=px&data[attribute][meta_typography_word_spacing][size]=&data[attribute][content_typography_typography]=&data[attribute][content_typography_font_family]=&data[attribute][content_typography_font_size][unit]=px&data[attribute][content_typography_font_size][size]=&data[attribute][content_typography_font_weight]=&data[attribute][content_typography_text_transform]=&data[attribute][content_typography_font_style]=&data[attribute][content_typography_text_decoration]=&data[attribute][content_typography_line_height][unit]=px&data[attribute][content_typography_line_height][size]=&data[attribute][content_typography_letter_spacing][unit]=px&data[attribute][content_typography_letter_spacing][size]=&data[attribute][content_typography_word_spacing][unit]=px&data[attribute][content_typography_word_spacing][size]=&data[attribute][ads_type_hover]=&data[attribute][ads_position_hover][unit]=px&data[attribute][ads_position_hover][size]=1&data[attribute][ads_random_hover]=&data[attribute][ads_image_hover][url]=&data[attribute][ads_image_hover][id]=&data[attribute][ads_image_hover][size]=&data[attribute][ads_image_tablet_hover][url]=&data[attribute][ads_image_tablet_hover][id]=&data[attribute][ads_image_tablet_hover][size]=&data[attribute][ads_image_phone_hover][url]=&data[attribute][ads_image_phone_hover][id]=&data[attribute][ads_image_phone_hover][size]=&data[attribute][ads_image_link_hover]=&data[attribute][ads_image_alt_hover]=&data[attribute][ads_image_new_tab_hover]=&data[attribute][google_publisher_id_hover]=&data[attribute][google_slot_id_hover]=&data[attribute][google_desktop_hover]=auto&data[attribute][google_tab_hover]=auto&data[attribute][google_phone_hover]=auto&data[attribute][content_hover]=&data[attribute][ads_bottom_text_hover]=&data[attribute][boxed_hover]=&data[attribute][boxed_shadow_hover]=&data[attribute][el_id_hover]=&data[attribute][el_class_hover]=&data[attribute][scheme_hover]=&data[attribute][column_width_hover]=auto&data[attribute][title_color_hover]=&data[attribute][accent_color_hover]=&data[attribute][alt_color_hover]=&data[attribute][excerpt_color_hover]=&data[attribute][css_hover]=&data[attribute][title_typography_typography_hover]=&data[attribute][title_typography_font_family_hover]=&data[attribute][title_typography_font_size_hover][unit]=px&data[attribute][title_typography_font_size_hover][size]=&data[attribute][title_typography_font_weight_hover]=&data[attribute][title_typography_text_transform_hover]=&data[attribute][title_typography_font_style_hover]=&data[attribute][title_typography_text_decoration_hover]=&data[attribute][title_typography_line_height_hover][unit]=px&data[attribute][title_typography_line_height_hover][size]=&data[attribute][title_typography_letter_spacing_hover][unit]=px&data[attribute][title_typography_letter_spacing_hover][size]=&data[attribute][title_typography_word_spacing_hover][unit]=px&data[attribute][title_typography_word_spacing_hover][size]=&data[attribute][_title_hover]=&data[attribute][_margin_hover][unit]=px&data[attribute][_margin_hover][top]=&data[attribute][_margin_hover][right]=&data[attribute][_margin_hover][bottom]=&data[attribute][_margin_hover][left]=&data[attribute][_margin_hover][isLinked]=true&data[attribute][_padding_hover][unit]=px&data[attribute][_padding_hover][top]=&data[attribute][_padding_hover][right]=&data[attribute][_padding_hover][bottom]=&data[attribute][_padding_hover][left]=&data[attribute][_padding_hover][isLinked]=true&data[attribute][_element_width_hover]=&data[attribute][_element_width_tablet_hover]=&data[attribute][_element_width_mobile_hover]=&data[attribute][_element_custom_width_hover][unit]=%25&data[attribute][_element_custom_width_hover][size]=&data[attribute][_element_vertical_align_hover]=&data[attribute][_position_description_hover]=&data[attribute][_position_hover]=&data[attribute][_offset_orientation_h_hover]=start&data[attribute][_offset_x_hover][unit]=px&data[attribute][_offset_x_hover][size]=0&data[attribute][_offset_x_end_hover][unit]=px&data[attribute][_offset_x_end_hover][size]=0&data[attribute][_offset_orientation_v_hover]=start&data[attribute][_offset_y_hover][unit]=px&data[attribute][_offset_y_hover][size]=0&data[attribute][_offset_y_end_hover][unit]=px&data[attribute][_offset_y_end_hover][size]=0&data[attribute][_z_index_hover]=&data[attribute][_element_id_hover]=&data[attribute][_css_classes_hover]=&data[attribute][_animation_hover]=&data[attribute][_animation_tablet_hover]=&data[attribute][_animation_mobile_hover]=&data[attribute][animation_duration_hover]=&data[attribute][_animation_delay_hover]=&data[attribute][_transform_rotate_popover_hover]=&data[attribute][_transform_rotateZ_effect_hover][unit]=px&data[attribute][_transform_rotateZ_effect_hover][size]=&data[attribute][_transform_rotateZ_effect_hover_tablet][unit]=deg&data[attribute][_transform_rotateZ_effect_hover_tablet][size]=&data[attribute][_transform_rotateZ_effect_hover_mobile][unit]=deg&data[attribute][_transform_rotateZ_effect_hover_mobile][size]=&data[attribute][_transform_rotate_3d_hover]=&data[attribute][_transform_rotateX_effect_hover][unit]=px&data[attribute][_transform_rotateX_effect_hover][size]=&data[attribute][_transform_rotateX_effect_hover_tablet][unit]=deg&data[attribute][_transform_rotateX_effect_hover_tablet][size]=&data[attribute][_transform_rotateX_effect_hover_mobile][unit]=deg&data[attribute][_transform_rotateX_effect_hover_mobile][size]=&data[attribute][_transform_rotateY_effect_hover][unit]=px&data[attribute][_transform_rotateY_effect_hover][size]=&data[attribute][_transform_rotateY_effect_hover_tablet][unit]=deg&data[attribute][_transform_rotateY_effect_hover_tablet][size]=&data[attribute][_transform_rotateY_effect_hover_mobile][unit]=deg&data[attribute][_transform_rotateY_effect_hover_mobile][size]=&data[attribute][_transform_perspective_effect_hover][unit]=px&data[attribute][_transform_perspective_effect_hover][size]=&data[attribute][_transform_perspective_effect_hover_tablet][unit]=px&data[attribute][_transform_perspective_effect_hover_tablet][size]=&data[attribute][_transform_perspective_effect_hover_mobile][unit]=px&data[attribute][_transform_perspective_effect_hover_mobile][size]=&data[attribute][_transform_translate_popover_hover]=&data[attribute][_transform_translateX_effect_hover][unit]=px&data[attribute][_transform_translateX_effect_hover][size]=&data[attribute][_transform_translateX_effect_hover_tablet][unit]=px&data[attribute][_transform_translateX_effect_hover_tablet][size]=&data[attribute][_transform_translateX_effect_hover_mobile][unit]=px&data[attribute][_transform_translateX_effect_hover_mobile][size]=&data[attribute][_transform_translateY_effect_hover][unit]=px&data[attribute][_transform_translateY_effect_hover][size]=&data[attribute][_transform_translateY_effect_hover_tablet][unit]=px&data[attribute][_transform_translateY_effect_hover_tablet][size]=&data[attribute][_transform_translateY_effect_hover_mobile][unit]=px&data[attribute][_transform_translateY_effect_hover_mobile][size]=&data[attribute][_transform_scale_popover_hover]=&data[attribute][_transform_keep_proportions_hover]=yes&data[attribute][_transform_scale_effect_hover][unit]=px&data[attribute][_transform_scale_effect_hover][size]=&data[attribute][_transform_scaleX_effect_hover][unit]=px&data[attribute][_transform_scaleX_effect_hover][size]=&data[attribute][_transform_scaleY_effect_hover][unit]=px&data[attribute][_transform_scaleY_effect_hover][size]=&data[attribute][_transform_skew_popover_hover]=&data[attribute][_transform_skewX_effect_hover][unit]=px&data[attribute][_transform_skewX_effect_hover][size]=&data[attribute][_transform_skewY_effect_hover][unit]=px&data[attribute][_transform_skewY_effect_hover][size]=&data[attribute][_transform_flipX_effect_hover]=&data[attribute][_transform_flipY_effect_hover]=&data[attribute][_transform_transition_hover][unit]=px&data[attribute][_transform_transition_hover][size]=&data[attribute][motion_fx_transform_x_anchor_point_hover]=&data[attribute][motion_fx_transform_y_anchor_point_hover]=&data[attribute][_background_background_hover]=&data[attribute][_background_gradient_notice_hover]=&data[attribute][_background_color_hover]=&data[attribute][_background_color_stop_hover][unit]=%25&data[attribute][_background_color_stop_hover][size]=0&data[attribute][_background_color_b_hover]=%23f2295b&data[attribute][_background_color_b_hover_stop][unit]=%25&data[attribute][_background_color_b_hover_stop][size]=100&data[attribute][_background_gradient_type_hover]=linear&data[attribute][_background_gradient_angle_hover][unit]=deg&data[attribute][_background_gradient_angle_hover][size]=180&data[attribute][_background_gradient_position_hover]=center+center&data[attribute][_background_image_hover][url]=&data[attribute][_background_image_hover][id]=&data[attribute][_background_image_hover][size]=&data[attribute][_background_position_hover]=&data[attribute][_background_xpos_hover][unit]=px&data[attribute][_background_xpos_hover][size]=0&data[attribute][_background_ypos_hover][unit]=px&data[attribute][_background_ypos_hover][size]=0&data[attribute][_background_attachment_hover]=&data[attribute][_background_repeat_hover]=&data[attribute][_background_size_hover]=&data[attribute][_background_bg_width_hover][unit]=%25&data[attribute][_background_bg_width_hover][size]=100&data[attribute][_background_video_link_hover]=&data[attribute][_background_video_start_hover]=&data[attribute][_background_video_end_hover]=&data[attribute][_background_video_play_once_hover]=&data[attribute][_background_video_play_on_mobile_hover]=&data[attribute][_background_video_privacy_mode_hover]=&data[attribute][_background_video_fallback_hover][url]=&data[attribute][_background_video_fallback_hover][id]=&data[attribute][_background_video_fallback_hover][size]=&data[attribute][_background_slideshow_loop_hover]=yes&data[attribute][_background_slideshow_slide_duration_hover]=5000&data[attribute][_background_slideshow_slide_transition_hover]=fade&data[attribute][_background_slideshow_transition_duration_hover]=500&data[attribute][_background_slideshow_background_size_hover]=&data[attribute][_background_slideshow_background_position_hover]=&data[attribute][_background_slideshow_lazyload_hover]=&data[attribute][_background_slideshow_ken_burns_hover]=&data[attribute][_background_slideshow_ken_burns_zoom_direction_hover]=in&data[attribute][_background_hover_transition]=&data[attribute][_border_border_hover]=&data[attribute][_border_width_hover][unit]=px&data[attribute][_border_width_hover][top]=&data[attribute][_border_width_hover][right]=&data[attribute][_border_width_hover][bottom]=&data[attribute][_border_hover_width]=&data[attribute][_border_hover_width][unit]=px&data[attribute][_border_hover_width][top]=&data[attribute][_border_hover_width][right]=&data[attribute][_border_hover_width][bottom]=&data[attribute][_border_hover_width][left]=&data[attribute][_border_hover_width][isLinked]=true&data[attribute][_border_hover_color]=&data[attribute][_border_radius_hover]=&data[attribute][_border_radius_hover][unit]=px&data[attribute][_border_radius_hover][top]=&data[attribute][_border_radius_hover][right]=&data[attribute][_border_radius_hover][bottom]=&data[attribute][_border_radius_hover][left]=&data[attribute][_border_radius_hover][isLinked]=true&data[attribute][_box_shadow_hover_box_shadow_type]=&data[attribute][_box_shadow_hover_box_shadow]=&data[attribute][_box_shadow_hover_box_shadow][horizontal]=0&data[attribute][_box_shadow_hover_box_shadow][vertical]=0&data[attribute][_box_shadow_hover_box_shadow][blur]=10&data[attribute][_box_shadow_hover_box_shadow][spread]=0&data[attribute][_box_shadow_hover_box_shadow][color]=rgba(0,0,0,0.5)&data[attribute][_box_shadow_hover_box_shadow_position]=&data[attribute][_border_hover_transition]=&data[attribute][_mask_switch_hover]=&data[attribute][_mask_shape_hover]=circle&data[attribute][_mask_image_hover]=&data[attribute][_mask_image_hover][url]=&data[attribute][_mask_image_hover][id]=&data[attribute][_mask_image_hover][size]=&data[attribute][_mask_notice_hover]=&data[attribute][_mask_size_hover]=contain&data[attribute][_mask_size_scale_hover][unit]=%25&data[attribute][_mask_size_scale_hover][size]=100&data[attribute][_mask_position_hover]=center+center&data[attribute][_mask_position_x_hover][unit]=%25&data[attribute][_mask_position_x_hover][size]=0&data[attribute][_mask_position_y_hover][unit]=%25&data[attribute][_mask_position_y_hover][size]=0&data[attribute][_mask_repeat_hover]=no-repeat"
        
#         # 發出下一個 POST 請求
#         yield scrapy.Request(
#             url="https://www.koc.com.tw/?ajax-request=jnews",
#             method='POST',
#             headers={'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8'},
#             body=body,
#             meta={'page': next_page},
#             callback=self.parse_ajax_response
#         )




#=====================================v.0.2============================================
# import scrapy
# from ..items import ArticleItem   # 確認你的 items.py 有 ArticleItem

# class KocSpider(scrapy.Spider):
#     name = "koc"
#     allowed_domains = ["koc.com.tw"]
#     start_urls = ["https://www.koc.com.tw/"]

#     def parse(self, response):
#         # 在首頁找到文章的區塊
#         articles = response.css("div.article")  # 這裡的選擇器要依實際網頁調整
#         for article in articles:
#             item = ArticleItem()
#             item["url"] = article.css("a::attr(href)").get()
#             item["title"] = article.css("a::text").get()
#             item["author"] = article.css("span.author::text").get()
#             item["published_at"] = article.css("span.date::text").get()
#             item["content"] = article.css("p::text").get()
#             yield item

#         # ❌ 不要再 follow 其他連結
#         # 這樣就只會抓首頁上的文章


#============================================ v.0.1 ============================================
# import scrapy
# from urllib.parse import urljoin
# from koc_crawler.items import ArticleItem

# class BlogSpider(scrapy.Spider):
#     name = "koc"
#     allowed_domains = ["koc.com.tw", "www.koc.com.tw"]
#     start_urls = ["https://www.koc.com.tw/"]

#     custom_settings = {
#         "DEPTH_LIMIT": 2
#     }

#     def parse(self, response):
#         # 1) 先從列舉頁 (listing) 找到每個 article block，並從中抓列表資料（title / author / date / excerpt）
#         for block in response.css('article.jeg_post'):
#             href = block.css('h3.jeg_post_title a::attr(href)').get()
#             if not href:
#                 continue
#             url = urljoin(response.url, href)

#             item = ArticleItem()
#             item["url"] = url
#             item["title"] = block.css('h3.jeg_post_title a::text').get(default="").strip()
#             # 正確取得作者：抓 <a> 的文字，避免抓到前面的 "by"
#             item["author"] = block.css('.jeg_meta_author a::text').get(default="").strip()
#             # 取得日期（列舉頁通常顯示可讀文字）
#             pub_text = block.css('.jeg_meta_date a::text').get()
#             item["published_at"] = pub_text.strip() if pub_text else ""
#             # 先把摘要當作 content 的初始值，真正的內文會在 article 頁面補完
#             excerpt = block.css('.jeg_post_excerpt p::text').getall()
#             item["content"] = "\n".join([p.strip() for p in excerpt if p.strip()])

#             # 帶著 item 去抓完整文章頁面，parse_article 會補完/覆寫欄位
#             yield scrapy.Request(url, callback=self.parse_article, meta={"item": item})

#         # 2) 跟隨站內的 archive / pagination / article 列表（只跟內含 /archives/ 或 分頁 的連結）
#         for href in response.css('a::attr(href)').getall():
#             url = urljoin(response.url, href)
#             if any(d in url for d in self.allowed_domains) and (
#                 '/archives/' in url or '/page/' in url or 'paged=' in url
#             ):
#                 yield scrapy.Request(url, callback=self.parse)

#     def parse_article(self, response):
#         # 由 parse 傳來的初始 item（若無則新建）
#         item = response.meta.get("item") or ArticleItem()

#         # 以文章頁面的 title/author/date/content 做優先覆寫（如有）
#         title = response.css('h1.entry-title::text, .post-title::text, .jeg_post_title a::text').get()
#         if title:
#             item["title"] = title.strip()

#         author = response.css('.jeg_meta_author a::text, .author a::text').get()
#         if author:
#             item["author"] = author.strip()

#         pub = response.css('time::attr(datetime), .jeg_meta_date a::text, time::text, .entry-date::text').get()
#         if pub:
#             item["published_at"] = pub.strip()

#         # 優先取文章內文（多個 selector 做補強），並把段落 join 起來
#         paragraphs = response.css(
#             'div.entry-content p::text, .post-content p::text, article p::text, .jeg_postblock_content p::text'
#         ).getall()
#         if paragraphs:
#             item["content"] = "\n".join([p.strip() for p in paragraphs if p.strip()])

#         yield item

